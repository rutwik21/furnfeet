"use strict";(()=>{var e={};e.id=649,e.ids=[649],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},90409:e=>{e.exports=require("payload")},39491:e=>{e.exports=require("assert")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},16797:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>U,originalPathname:()=>S,requestAsyncStorage:()=>D,routeModule:()=>v,serverHooks:()=>N,staticGenerationAsyncStorage:()=>I,staticGenerationBailout:()=>j});var a={};r.r(a),r.d(a,{GET:()=>handler,POST:()=>handler});var s=r(10884),i=r(16132),o=r(11287);let n=o.z.object({email:o.z.string().email(),phone:o.z.number().or(o.z.string()),password:o.z.string().min(8,{message:"Password must be at least 8 characters long."})}),d=o.z.object({email:o.z.string().email(),password:o.z.string()});var c=r(14273);let l=c.rN.context().create(),u=l.middleware,p=u(async({ctx:e,next:t})=>{let r=e.req,{user:a}=r;if(!a||!a.id)throw new c.bR({code:"UNAUTHORIZED"});return t({ctx:{user:a}})}),w=l.router,m=l.procedure,z=l.procedure.use(p);var h=r(80623);let y=w({createPayloadUser:m.input(n).mutation(async({input:e})=>{let{email:t,phone:r,password:a}=e;r=Number(r);let s=await (0,h.T)(),{docs:i}=await s.find({collection:"users",where:{email:{equals:t}}});if(0!==i.length)throw new c.bR({code:"CONFLICT"});return await s.create({collection:"users",data:{email:t,phone:r,password:a,role:"user"}}),{success:!0,sentToEmail:t}}),verifyEmail:m.input(o.z.object({token:o.z.string()})).query(async({input:e})=>{let{token:t}=e,r=await (0,h.T)(),a=await r.verifyEmail({collection:"users",token:t});if(!a)throw new c.bR({code:"UNAUTHORIZED"});return{success:!0}}),signIn:m.input(d).mutation(async({input:e,ctx:t})=>{let{email:r,password:a}=e,{res:s}=t,i=await (0,h.T)();try{return await i.login({collection:"users",data:{email:r,password:a},res:s}),{success:!0}}catch(e){throw new c.bR({code:"UNAUTHORIZED"})}})}),g=o.z.object({category:o.z.string().optional(),sort:o.z.enum(["asc","desc"]).optional(),limit:o.z.number().optional()});var b=r(72384),q=r.n(b);let _=new(q())({key_id:process.env.RAZORPAY_KEY_ID,key_secret:process.env.RAZORPAY_KEY_SECRET}),f=o.z.object({razorpay_order_id:o.z.string(),razorpay_payment_id:o.z.string(),razorpay_signature:o.z.string(),orderId:o.z.string()}),R=w({createSession:z.input(o.z.array(o.z.object({productId:o.z.string(),qty:o.z.number().int(),dimensions:o.z.array(o.z.object({length:o.z.number(),width:o.z.number(),height:o.z.number().nullable().optional(),unit:o.z.literal("inch"),id:o.z.string().nullable().optional()})),price:o.z.number(),totalPrice:o.z.number()}))).mutation(async({ctx:e,input:t})=>{let{user:r}=e;if(0===t.length)throw new c.bR({code:"BAD_REQUEST"});let a=await (0,h.T)(),s=t.map(({totalPrice:e})=>e),i=10;s.forEach(e=>{i+=Number(e)});let o=t.map(e=>({productId:e.productId,qty:e.qty,dimensions:e.dimensions,price:e.totalPrice}));try{let e={amount:i+"00",currency:"INR"},t="";for(_.orders.create(e,async(e,s)=>{if(e)throw new c.bR({code:"BAD_REQUEST"});let{docs:n}=await a.find({collection:"addresses",where:{user:{equals:r.id},isDefaultAddress:{equals:!0}},limit:1});await a.create({collection:"orders",data:{_isPaid:!1,orderId:s.id,address:n[0].id,data:o,totalOrderValue:i,user:r.id}}),t=s.id});!t;)await new Promise(e=>setTimeout(e,500));return{key_id:process.env.RAZORPAY_KEY_ID,orderId:t}}catch(e){return{key_id:null,orderId:null}}}),markOrderAsPaid:z.input(f).mutation(async({ctx:e,input:t})=>{let{user:r}=e;try{if(!t.orderId||!t.razorpay_order_id)throw new c.bR({code:"BAD_REQUEST"});let e=await (0,h.T)();return await e.update({collection:"orders",data:{_isPaid:!0,razorpayPaymentId:t.razorpay_payment_id},where:{orderId:{equals:t.orderId},user:{equals:r.id}}}),t.orderId}catch(e){return null}}),pollOrderStatus:z.input(o.z.object({orderId:o.z.string()})).query(async({input:e})=>{let{orderId:t}=e,r=await (0,h.T)(),{docs:a}=await r.find({collection:"orders",where:{id:{equals:t}}});if(!a.length)throw new c.bR({code:"NOT_FOUND"});let[s]=a;return{isPaid:s._isPaid}})}),x=o.z.object({name:o.z.string(),contact:o.z.number().or(o.z.string()),addressLine1:o.z.string(),addressLine2:o.z.string().nullable(),city:o.z.string(),state:o.z.string(),pinCode:o.z.string()}),T=o.z.object({id:o.z.string(),name:o.z.string(),contact:o.z.number().or(o.z.string()),addressLine1:o.z.string(),addressLine2:o.z.string().nullable(),city:o.z.string(),state:o.z.string(),pinCode:o.z.string(),isDefaultAddress:o.z.boolean()}),A=w({addNewAddress:z.input(x).mutation(async({ctx:e,input:t})=>{let{user:r}=e,{name:a,contact:s,addressLine1:i,addressLine2:o,city:n,state:d,pinCode:l}=t;if(""==t.name||""==t.addressLine1||""==t.city||""==t.state||""==t.pinCode||10!=t.contact.toString().length)throw new c.bR({code:"BAD_REQUEST"});try{let e=await (0,h.T)();await e.update({user:r,collection:"addresses",data:{isDefaultAddress:!1},where:{user:{equals:r.id}}}),s=Number(s),await e.create({user:r,collection:"addresses",data:{name:a,contact:s,addressLine1:i,addressLine2:o,city:n,state:d,pinCode:l,isDefaultAddress:!0}});let{docs:t}=await e.find({collection:"addresses",where:{user:{equals:r.id}}});return t}catch(e){throw console.log(e),new c.bR({code:"NOT_FOUND"})}}),updateAddress:z.input(T).mutation(async({ctx:e,input:t})=>{let{user:r}=e,{id:a,name:s,contact:i,addressLine1:o,addressLine2:n,city:d,state:l,pinCode:u,isDefaultAddress:p}=t;if(t.id,""==t.name||""==t.addressLine1||""==t.city||""==t.state||""==t.pinCode||10!=t.contact.toString().length)throw new c.bR({code:"BAD_REQUEST"});try{let e=await (0,h.T)();!0==p&&await e.update({user:r,collection:"addresses",data:{isDefaultAddress:!1},where:{user:{equals:r.id}}}),i=Number(i),await e.update({user:r,collection:"addresses",data:{name:s,contact:i,addressLine1:o,addressLine2:n||"",city:d,state:l,pinCode:u,isDefaultAddress:p},where:{id:{equals:a}}});let{docs:t}=await e.find({collection:"addresses",where:{user:{equals:r.id}}});return t}catch(e){throw console.log(e),new c.bR({code:"NOT_FOUND"})}}),allAddresses:z.query(async({ctx:e})=>{let{user:t}=e;try{let e=await (0,h.T)(),{docs:r}=await e.find({collection:"addresses",where:{user:{equals:t.id}}});return r}catch(e){throw console.log(e),new c.bR({code:"NOT_FOUND"})}})}),E=w({fabricOptions:m.input(o.z.object({maxRate:o.z.number().min(1),clothCategory:o.z.string()})).mutation(async({input:e})=>{let{maxRate:t,clothCategory:r}=e;try{let e=await (0,h.T)(),{docs:a}=await e.find({collection:"products",depth:2,where:{category:{equals:"raw_materials"},subcategory:{contains:r},"price.finalPrice":{less_than_equal:t},approvedForSale:{equals:"approved"}}});return a}catch(e){throw console.log(e),new c.bR({code:"NOT_FOUND"})}})}),O=w({auth:y,payment:R,user:A,product:E,getInfiniteProducts:m.input(o.z.object({limit:o.z.number().min(1).max(100),cursor:o.z.number().nullish(),query:g})).query(async({input:e})=>{let{query:t,cursor:r}=e,{sort:a,limit:s,...i}=t,o=await (0,h.T)(),n={};Object.entries(i).forEach(([e,t])=>{n[e]={equals:t}});let{docs:d,hasNextPage:c,nextPage:l}=await o.find({collection:"products",where:{approvedForSale:{equals:"approved"},...n},sort:a,depth:1,limit:s,page:r||1});return{items:d,nextPage:c?l:null}})});var P=r(1603);let handler=e=>{(0,P.w)({endpoint:"/api/trpc",req:e,router:O,createContext:()=>({})})},v=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/trpc/[trpc]/route",pathname:"/api/trpc/[trpc]",filename:"route",bundlePath:"app/api/trpc/[trpc]/route"},resolvedPagePath:"C:\\Users\\Truecopy\\Desktop\\New folder (2)\\furnfeet\\src\\app\\api\\trpc\\[trpc]\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:D,staticGenerationAsyncStorage:I,serverHooks:N,headerHooks:U,staticGenerationBailout:j}=v,S="/api/trpc/[trpc]/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[99,203,623],()=>__webpack_exec__(16797));module.exports=r})();